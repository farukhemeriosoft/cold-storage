import{B as e,D as t,E as n,F as r,G as i,H as ee,J as a,K as o,L as s,M as c,Q as l,T as u,V as d,X as f,d as te,p as ne,q as p,v as m,w as h,z as g}from"./index-6BYkH0DY.js";import{b as re}from"./AppHeader-BKR7rNi1.js";import"./LanguageSwitcher-Bwn7UERh.js";const ie={class:`min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300`},ae={class:`w-full py-8 px-4 sm:px-6 lg:px-8`},oe={class:`max-w-7xl mx-auto`},se={class:`flex justify-between items-center mb-8`},ce={class:`flex space-x-4`},le={class:`bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6`},ue={class:`grid grid-cols-1 md:grid-cols-4 gap-4`},de=[`value`],_={key:0,class:`flex justify-center items-center py-12`},v={key:1,class:`bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-300 px-4 py-3 rounded-lg mb-6`},y={key:2,class:`bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden`},b={class:`overflow-x-auto`},x={class:`min-w-full divide-y divide-gray-200 dark:divide-gray-700`},S={class:`bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700`},C={class:`px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white`},w={class:`px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400`},T={class:`px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400`},E={class:`px-6 py-4 whitespace-nowrap`},D={class:`px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400`},O={class:`px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400`},k={class:`px-6 py-4 whitespace-nowrap text-sm font-medium`},A={class:`flex space-x-2`},j=[`onClick`],M=[`onClick`],N=[`onClick`],P={key:0,class:`bg-white dark:bg-gray-800 px-4 py-3 border-t border-gray-200 dark:border-gray-700 sm:px-6`},F={class:`flex items-center justify-between`},I={class:`flex-1 flex justify-between sm:hidden`},L=[`disabled`],R=[`disabled`],z={class:`hidden sm:flex-1 sm:flex sm:items-center sm:justify-between`},fe={class:`text-sm text-gray-700 dark:text-gray-300`},B={class:`font-medium`},V={class:`font-medium`},pe={class:`font-medium`},me={class:`relative z-0 inline-flex rounded-md shadow-sm -space-x-px`},he=[`disabled`],ge=[`disabled`],_e={__name:`DispatchHistory`,setup(_e){te();let H=u([]),U=u([]),W=u({}),G=u(!1),K=u(``),q=u(0),J=u({search:``,status:``,customer_id:``}),Y=null;a(async()=>{await ve(),await X(),await Z()});let ve=async()=>{try{let e=await ne.getCustomers(1),t=e.data.data||e.data;U.value=t.data||t||[]}catch(e){console.error(`Error loading customers:`,e)}},X=async(e=1)=>{G.value=!0,K.value=``;try{let t={page:e,...J.value};Object.keys(t).forEach(e=>{(t[e]===``||t[e]===null||t[e]===void 0)&&delete t[e]});let n=await p.getHistory(t),r=n.data.data;H.value=r.data||[],W.value={current_page:r.current_page,last_page:r.last_page,from:r.from,to:r.to,total:r.total,prev_page_url:r.prev_page_url,next_page_url:r.next_page_url}}catch(e){console.error(`Error loading dispatch history:`,e),K.value=`Failed to load dispatch history`}finally{G.value=!1}},Z=async()=>{try{let e=await p.getPendingApprovals();q.value=e.data.data.length}catch(e){console.error(`Error loading pending count:`,e)}},Q=e=>{e>=1&&e<=W.value.last_page&&X(e)},ye=()=>{Y&&clearTimeout(Y),Y=setTimeout(()=>{X(1)},500)},be=()=>{J.value={search:``,status:``,customer_id:``},X(1)},xe=async e=>{try{await p.completeDispatch(e),await X(W.value.current_page),await Z()}catch(e){console.error(`Error completing dispatch:`,e),K.value=`Failed to complete dispatch`}},$=async(e,t)=>{try{await p.approveDispatch(e,{action:t}),await X(W.value.current_page),await Z()}catch(e){console.error(`Error approving dispatch:`,e),K.value=`Failed to ${t} dispatch`}},Se=e=>{let t={pending:`bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300`,approved:`bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300`,dispatched:`bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300`,cancelled:`bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300`};return t[e]||`bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300`},Ce=e=>new Intl.NumberFormat(`en-PK`).format(e),we=e=>{if(!e)return`N/A`;let t=new Date(e);return t.toLocaleDateString(`en-US`,{year:`numeric`,month:`short`,day:`numeric`,hour:`2-digit`,minute:`2-digit`})};return o(()=>{Y&&clearTimeout(Y)}),(a,o)=>(s(),n(`div`,ie,[ee(re,{title:`Dispatch History`,"show-back":!0}),e(`div`,ae,[e(`div`,oe,[e(`div`,se,[o[10]||=e(`div`,null,[e(`h2`,{class:`text-3xl font-bold text-gray-900 dark:text-white mb-2`},`Dispatch History`),e(`p`,{class:`text-gray-600 dark:text-gray-400`},`View all dispatch records and approvals`)],-1),e(`div`,ce,[e(`button`,{onClick:o[0]||=(...e)=>a.loadPendingApprovals&&a.loadPendingApprovals(...e),class:`inline-flex items-center px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition-colors duration-200 font-medium`},[o[8]||=e(`svg`,{class:`w-5 h-5 mr-2`,fill:`none`,viewBox:`0 0 24 24`,stroke:`currentColor`},[e(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z`})],-1),i(` Pending Approvals (`+f(q.value)+`) `,1)]),e(`button`,{onClick:X,class:`inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 font-medium`},[...o[9]||=[e(`svg`,{class:`w-5 h-5 mr-2`,fill:`none`,viewBox:`0 0 24 24`,stroke:`currentColor`},[e(`path`,{"stroke-linecap":`round`,"stroke-linejoin":`round`,"stroke-width":`2`,d:`M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15`})],-1),i(` Refresh `,-1)]])])]),e(`div`,le,[e(`div`,ue,[e(`div`,null,[o[11]||=e(`label`,{class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2`},` Search `,-1),l(e(`input`,{"onUpdate:modelValue":o[1]||=e=>J.value.search=e,type:`text`,placeholder:`Barcode or Dispatch #`,class:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white`,onInput:ye},null,544),[[h,J.value.search]])]),e(`div`,null,[o[13]||=e(`label`,{class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2`},` Status `,-1),l(e(`select`,{"onUpdate:modelValue":o[2]||=e=>J.value.status=e,class:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white`,onChange:X},[...o[12]||=[r(`<option value="">All Status</option><option value="pending">Pending</option><option value="approved">Approved</option><option value="dispatched">Dispatched</option><option value="cancelled">Cancelled</option>`,5)]],544),[[m,J.value.status]])]),e(`div`,null,[o[15]||=e(`label`,{class:`block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2`},` Customer `,-1),l(e(`select`,{"onUpdate:modelValue":o[3]||=e=>J.value.customer_id=e,class:`w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white`,onChange:X},[o[14]||=e(`option`,{value:``},`All Customers`,-1),(s(!0),n(g,null,c(U.value,e=>(s(),n(`option`,{key:e.id,value:e.id},f(e.full_name),9,de))),128))],544),[[m,J.value.customer_id]])]),e(`div`,{class:`flex items-end`},[e(`button`,{onClick:be,class:`w-full px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors duration-200 font-medium`},` Clear Filters `)])])]),G.value?(s(),n(`div`,_,[...o[16]||=[e(`div`,{class:`animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500`},null,-1)]])):K.value?(s(),n(`div`,v,f(K.value),1)):(s(),n(`div`,y,[e(`div`,b,[e(`table`,x,[o[17]||=e(`thead`,{class:`bg-gray-50 dark:bg-gray-700`},[e(`tr`,null,[e(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Dispatch # `),e(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Barcode `),e(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Customer `),e(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Status `),e(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Amount `),e(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Created `),e(`th`,{class:`px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider`},` Actions `)])],-1),e(`tbody`,S,[(s(!0),n(g,null,c(H.value,r=>(s(),n(`tr`,{key:r.id,class:`hover:bg-gray-50 dark:hover:bg-gray-700`},[e(`td`,C,f(r.dispatch_number),1),e(`td`,w,f(r.barcode),1),e(`td`,T,f(r.customer?.full_name||`N/A`),1),e(`td`,E,[e(`span`,{class:d([Se(r.status),`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium`])},f(r.status),3)]),e(`td`,D,` PKR `+f(Ce(r.total_amount)),1),e(`td`,O,f(we(r.created_at)),1),e(`td`,k,[e(`div`,A,[r.status===`approved`?(s(),n(`button`,{key:0,onClick:e=>xe(r.id),class:`text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300`},` Complete `,8,j)):t(``,!0),r.status===`pending`?(s(),n(`button`,{key:1,onClick:e=>$(r.id,`approve`),class:`text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300`},` Approve `,8,M)):t(``,!0),r.status===`pending`?(s(),n(`button`,{key:2,onClick:e=>$(r.id,`reject`),class:`text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300`},` Reject `,8,N)):t(``,!0)])])]))),128))])])]),W.value.last_page>1?(s(),n(`div`,P,[e(`div`,F,[e(`div`,I,[e(`button`,{onClick:o[4]||=e=>Q(W.value.current_page-1),disabled:!W.value.prev_page_url,class:`relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed`},` Previous `,8,L),e(`button`,{onClick:o[5]||=e=>Q(W.value.current_page+1),disabled:!W.value.next_page_url,class:`ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed`},` Next `,8,R)]),e(`div`,z,[e(`div`,null,[e(`p`,fe,[o[18]||=i(` Showing `,-1),e(`span`,B,f(W.value.from),1),o[19]||=i(` to `,-1),e(`span`,V,f(W.value.to),1),o[20]||=i(` of `,-1),e(`span`,pe,f(W.value.total),1),o[21]||=i(` results `,-1)])]),e(`div`,null,[e(`nav`,me,[e(`button`,{onClick:o[6]||=e=>Q(W.value.current_page-1),disabled:!W.value.prev_page_url,class:`relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed`},` Previous `,8,he),e(`button`,{onClick:o[7]||=e=>Q(W.value.current_page+1),disabled:!W.value.next_page_url,class:`relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed`},` Next `,8,ge)])])])])])):t(``,!0)]))])])]))}};var H=_e;export{H as default};